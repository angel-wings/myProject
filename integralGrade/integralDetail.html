<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="author" content="guozhenglei">
    <title>积分明细</title>
    <link rel="stylesheet" href="./css/common.css">
    <script src="./js/jquery.min.js"></script>
    <script src="./js/dropload.js"></script>
    <script src="./js/fastclick.js"></script>
    <script src="./js/public.js"></script>
    <script src="./js/prefixfree.js"></script>

    <style>
        body {
            padding-top: .48rem;
        }

        .content {
            padding-left: .8rem;
            background-color: #fff;
            box-sizing: border-box;
        }

        .conitem {
            width: 19.2rem;
            height: 3.2rem;
            margin: 0 auto;
            border-bottom: 1px solid #ddd;
        }

        .conitem:last-child {
            border: none;
        }

        .conitem-index {
            float: right;
            height: 3.2rem;
            width: 4.2rem;
            font-size: 24px;
            margin-right: .8rem;
            line-height: 3.2rem;
            text-align: right;
            color: #b2b2b2;
        }

        .conitem-text {
            display: inline-block;
            width: 13.6rem;
            margin-top: .48rem;
        }

        .conitem-title {
            font-size: 14px;
            display: block;
            margin-bottom: .16rem;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .conitem-des {
            font-size: 12px;
            color: #707070;
        }

        /* //////////////////////////////////// */

        .dropload-up,
        .dropload-down {
            position: relative;
            height: 0;
            overflow: hidden;
            font-size: 12px;
            /* 开启硬件加速 */
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        .dropload-down {
            height: 50px;
        }

        .dropload-refresh,
        .dropload-update,
        .dropload-load,
        .dropload-noData {
            height: 50px;
            line-height: 50px;
            text-align: center;
        }

        .dropload-load .loading {
            display: inline-block;
            height: 15px;
            width: 15px;
            border-radius: 100%;
            margin: 6px;
            border: 2px solid #666;
            border-bottom-color: transparent;
            vertical-align: middle;
            -webkit-animation: rotate 0.75s linear infinite;
            animation: rotate 0.75s linear infinite;
        }

        @-webkit-keyframes rotate {
            0% {
                -webkit-transform: rotate(0deg);
            }
            50% {
                -webkit-transform: rotate(180deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            50% {
                transform: rotate(180deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="isloading">
        <div class="loadimg">
            <img src="./images/loading.gif">
            <div>加载中...</div>
        </div>
    </div>
    <div class="inteMain">
        <ul class="content main">
            <!-- 明细 -->
        </ul>
    </div>

    <div class="toast"></div>
</body>
<script>

    $(function () {
        FastClick.attach(document.body);
        var pageSize = 15;
        var page = 0;
        setTimeout(function () {
            getDroploadPages()
        }, 500);

        // 获取积分明细
        function getIntegralDetail() {

            ajaxSubmit(
                'GET',
                '/api/v23/h5/userinfo/point/record/list?pageSize=15&pageIndex=1',
                '',
                function (data) {
                    var html = "";
                    if (data.error == 10000) {
                        //请求成功
                        var pointList = data.data;

                        if (pointList && pointList.length > 0) {
                            for (var i = 0; i < pointList.length; i++) {
                                var fuhao = '+';
                                html += '<li class="conitem"><div class="conitem-text"><span class="conitem-title">' + pointList[i].pointDesc + '</span>';
                                html += '<small class="conitem-des">' + pointList[i].pointDate + '</small></div>';
                                if (pointList[i].point < 0) {
                                    fuhao = '-';
                                }
                                html += '<span class="conitem-index" style="color:#33C4C2">' + fuhao + pointList[i].point + '</span></li>';
                            }
                            $('.content').html(html);
                            $('.isloading').css({ display: "none" });
                            $('.main').css({ display: "block" });
                            getDroploadPages();
                        } else {
                            $('.content').html(html);
                            $('.isloading').css({ display: "none" });
                            $('.main').css({ display: "block" });
                        }
                    } else {
                        toast(data.message);
                    }
                }, function (data) {
                    // toast('服务器开小差');
                })
        }

        // dropload调用
        function getDroploadPages() {
            $('.isloading').css({ display: "none" });
            $('.main').css({ display: "block" });
            $('.inteMain').dropload({
                scrollArea: window,
                loadDownFn: function (me) {
                    page++;
                    var result = '';

                    ajaxSubmit(
                        'GET',
                        '/api/v23/h5/userinfo/point/record/list?pageSize=' + pageSize + '&pageIndex=' + page,
                        '',
                        function (data) {
                            if (data.error == 10000) {
                                //请求成功
                                var pointList = data.data;
                                if (pointList && pointList.length > 0) {
                                    for (var i = 0; i < pointList.length; i++) {
                                        var fuhao = '+';
                                        result += '<li class="conitem"><div class="conitem-text"><span class="conitem-title">' + pointList[i].pointDesc + '</span>';
                                        result += '<small class="conitem-des">' + pointList[i].pointDate + '</small></div>';
                                        if (pointList[i].point < 0) {
                                            fuhao = '';
                                        }
                                        result += '<span class="conitem-index" style="color:#33C4C2">' + fuhao + pointList[i].point + '</span></li>';
                                    }
                                    $('.content').append(result);
                                    $('.isloading').css({ display: "none" });
                                    $('.main').css({ display: "block" });
                                    me.resetload();
                                } else {
                                    me.lock(); // 锁定
                                    me.noData();// 无数据
                                    me.resetload();// 重置
                                }
                            } else {
                                me.noData();// 无数据
                                me.resetload();
                                toast(data.message);
                            }
                        }, function (data) {
                            me.noData();// 无数据
                            me.resetload();
                            toast('服务器开小差');
                        })
                }
            });
        }
    })

</script>

</html>